
senadoresList = null;
let $partidos = [{
    imgTotales: "morena_M.png",
    abreviatura: "morena",
    nombre: "Morena",
    total: 0,
    color: '#610200'
}, {
    imgTotales: "pan_M.png",
    abreviatura: "PAN",
    nombre: "Partido Acción Nacional",
    total: 0,
    color: '#19589a'
},{
    imgTotales: "pri_M.png",
    abreviatura: "PRI",
    nombre: "Partido Revolucionario Institucional",
    total: 0,
    color: '#5DA456'
}, {
    imgTotales: "mc_M.png",
    abreviatura: "Movimiento Ciudadano",
    nombre: "Movimiento Ciudadano",
    total: 0,
    color: '#F38215'
}, {
    imgTotales: "pve_M.png",
    abreviatura: "PVEM",
    nombre: "Partido Verde Ecologista de México",
    total: 0,
    color: '#78d154'
}, {
    imgTotales: "pt_M.png",
    abreviatura: "PT",
    nombre: "Partido del Trabajo",
    total: 0,
    color: '#bb2a22'
}, {
    imgTotales: "sg_M.png",
    abreviatura: "SG",
    nombre: "Sin Partido",
    total: 0,
    color: '#A9AAAD'
}, {
    imgTotales: "pes_M.png",
    abreviatura: "PES",
    nombre: "Encuentro Social",
    total: 0,
    color: '#752F8B'
}, {
    imgTotales: "prd_M.png",
    abreviatura: "PRD",
    nombre: "Partido de la Revolución Democrática",
    total: 0,
    color: '#FFD807'
}];


let $partidos_temporal = [
    {
        "imgTotales": "morena_M.png",
        "abreviatura": "morena",
        "nombre": "Morena",
        "total": 57,
        "color": "#610200"
    },
    {
        "imgTotales": "pan_M.png",
        "abreviatura": "PAN",
        "nombre": "Partido Acción Nacional",
        "total": 18,
        "color": "#19589a"
    },
    {
        "imgTotales": "pri_M.png",
        "abreviatura": "PRI",
        "nombre": "Partido Revolucionario Institucional",
        "total": 14,
        "color": "#5DA456"
    },
    {
        "imgTotales": "mc_M.png",
        "abreviatura": "Movimiento Ciudadano",
        "nombre": "Movimiento Ciudadano",
        "total": 12,
        "color": "#F38215"
    },
    {
        "imgTotales": "pve_M.png",
        "abreviatura": "PVEM",
        "nombre": "Partido Verde Ecologista de México",
        "total": 8,
        "color": "#78d154"
    },
    {
        "imgTotales": "pt_M.png",
        "abreviatura": "PT",
        "nombre": "Partido del Trabajo",
        "total": 6,
        "color": "#bb2a22"
    },
    {
        "imgTotales": "sg_M.png",
        "abreviatura": "SG",
        "nombre": "Sin Partido",
        "total": 5,
        "color": "#A9AAAD"
    },
    {
        "imgTotales": "pes_M.png",
        "abreviatura": "PES",
        "nombre": "Encuentro Social",
        "total": 4,
        "color": "#752F8B"
    },
    {
        "imgTotales": "prd_M.png",
        "abreviatura": "PRD",
        "nombre": "Partido de la Revolución Democrática",
        "total": 3,
        "color": "#FFD807"
    }
];


function cerrarDetalle() {
    $("#cont_mapa").show(),
    $("#cont_detalle").hide()
}
function copiarAlPortapapeles(a, o) {
    $css = "margin-left:" + o + ";margin-top:" + a + ";";
    var e = document.createElement("input");
    e.setAttribute("value", $css),
    document.body.appendChild(e),
    e.select(),
    document.execCommand("copy"),
    document.body.removeChild(e)
}
async function leerSenadores(a) {
    return await new Promise((async(o,e)=>{
        $.getJSON("../js/senadores.json", {
            _: (new Date).getTime()
        }).done((async function(e) {
            senadoresList = e;
            $.each(a, (async function(a, o) {
                $senador = e.find((a=>a.idSenador == o.id_senador)),
                $senador ? "licencia" == o.status ? ($class = "circulo c_nulo",
                $senador = {
                    imagen: ""
                }) : ($color = "c_" + $senador.Fraccion.toLowerCase().replace(" ", "_"),
                $hr = "hr-" + $senador.Fraccion.toLowerCase().replace(" ", "_"),
                $logo = "Movimiento Ciudadano" == $senador.Fraccion ? "MC_.png" : $senador.Fraccion.toUpperCase() + "_.png",
                $class = "icon-asambleitas-partido hand circulo " + $color,
                $tel = $senador.telefono,
                $ext = $senador.extension,
                $redes_correo = "" == $senador.correo ? "" : '<a><i class="redes t_pri bi bi-envelope-fill"></i></a>',
                $redes_facebook = "" == $senador.facebook ? "" : '<a><i class="redes t_pri bi bi-facebook"></i></a>',
                $redes_twitter = "" == $senador.twitter ? "" : '<a><i class="redes t_pri bi bi-twitter"></i></a>',
                $redes_youtube = "" == $senador.youtube ? "" : '<a><i class="redes t_pri bi bi-youtube"></i></a>',
                $redes_instagram = "" == $senador.instagram ? "" : '<a><i class="redes t_pri bi bi-instagram"></i></a>',
                $redes_url_sitio = "" == $senador.url_sitio ? "" : '<a><i class="redes t_pri bi bi-browser-chrome"></i></a>',
                $partidos.find(((a,o)=>a.abreviatura == $senador.Fraccion ? $partidos[o].total += 1 : ""))) : "licencia" == o.status ? ($color = "c_nulo",
                $class = "circulo " + $color,
                $senador = {
                    imagen: ""
                }) : ($class = "circulo c_nulo",
                $senador = {
                    imagen: ""
                });
                let i = navigator.userAgent
                  , t = $("#contMapa").width();
                i.match(/Iphone/i) || i.match(/Ipod/i) || i.match(/Android/i) || i.match(/J2ME/i) || i.match(/BlackBerry/i) || i.match(/iPhone|iPad|iPod/i) || i.match(/Opera Mini/i) || i.match(/IEMobile/i) || i.match(/Mobile/i) || i.match(/Windows Phone/i) || i.match(/windows mobile/i) || i.match(/windows ce/i) || i.match(/webOS/i) || i.match(/palm/i) || i.match(/bada/i) || i.match(/series60/i) || i.match(/nokia/i) || i.match(/symbian/i) || i.match(/HTC/i) || t <= 400 ? $contCirculo = $("<div/>", {
                    class: "circulo"
                }).css({
                    "margin-left": o.style_small.left,
                    "margin-top": o.style_small.top
                }) : (y = parseInt(o.style.left) + 25,
                $contCirculo = $("<div/>", {
                    class: "circulo"
                }).css({
                    opacity: ".1",
                    "margin-left": o.style.left,
                    "margin-top": o.style.top
                }).animate({
                    opacity: "1"
                }, 1200)),
                $miniFoto = $("<div/>").css({
                    width: "25px",
                    overflow: "hidden",
                    "border-radius": "100%",
                    "margin-top": "-12px"
                }).html($("<img>").attr({
                    src: "../images/senadores/64/" + $senador.Foto,
                    width: "20",
                    class: "radiusMap"
                })),
                $("<div/>", {
                    class: $class,
                    id: "xy_" + o.id,
                    id_senador: $senador.idSenador
                }).appendTo($contCirculo),
                $contCirculo.append($('<span class="txt_curul">' + (a + 1) + "</span>")),
                $contCirculo.appendTo("#cont_mapa").fadeIn("slow"),
                $pin = $("<div>", {
                    class: "pin pin-down pin_" + $senador.idSenador,
                    id: "info_" + o.id
                }).css({
                    width: "288px",
                    "background-color": "#FFF",
                    "z-index": "20001"
                }),
                $pin.append($("<div>", {
                    class: "card p-1"
                })),
                $pin.find(".card").append('<div class="row" >'),
                $pin.find(".card").append('<div class="card-body" style="padding: 1rem 1px;">'),
                $pin.find(".row").append('<div class="col-4" >'),
                $pin.find(".row").append('<div class="col-5 px-0" >'),
                $pin.find(".row").append('<div class="col-3 px-0" >'),
                $pin.find(".col-4").append($("<img>").attr({
                    src: "../images/senadores/64/" + $senador.Foto,
                    width: "70"
                })),
                $pin.find(".col-5").append($('<span class="d-flex flex-column">').append($("<img>").attr({
                    src: "../images/escudos/" + $senador.Escudo,
                    width: "40"
                }))),
                $pin.find(".col-5").append($('<span class="d-flex flex-column fst-italic text-start">').html($senador.Estado)),
                $pin.find(".col-3").append($("<img>").attr({
                    src: "../images/iconos_partidos/" + $logo,
                    width: "50"
                })),
                $pin.find(".card-body").append('<p class="card-title text-center fw-bold fs-6">Sen. ' + $senador.Nombre + " " + $senador.Apellidos + "</p>"),
                $pin.find(".card-body").append('<hr class="' + $hr + '">'),
                null !== $tel && $pin.find(".card-body").append('<strong>Tel.</strong>: <span class="">01 (55) ' + $tel + "</span> <strong>ext.</strong>: " + $ext + "<br>"),
                null !== $senador.correo && $pin.find(".card-body").append('<p class="">' + $senador.correo + "</p>"),
                $pin.appendTo("#contInfoSenadores").hide()
            }
            )),
            tblTotalesPartidos($partidos_temporal),
            await o(!0)
        }
        )).fail((function() {
            e("error al leer los datos")
        }
        ))
    }
    ))
}
async function leerCoordMap() {
    return await new Promise((async(a,o)=>{
        $.getJSON("../js/curules_posicion.json", {
            _: (new Date).getTime()
        }).done((async function(e) {
            e || o("Error json"),
            await a(e)
        }
        )).fail((function() {
            o("error al leer los datos")
        }
        ))
    }
    ))
}
function tblTotalesPartidos(a) {
    $trs = $("<tbody/>"),
    $.each(a, (async function(a, o) {
        $logo = "Movimiento Ciudadano" == o.abreviatura ? "MC" : o.abreviatura.toUpperCase() + "",
        rand = Math.floor(100 * Math.random()),
        $(".intPartidos").append(`\n                    <div class="col-xxl-3 col-xl-3 col-lg-4 col-md-6 col-sm-12 col-xs-12 mb-4">\n                        <a href="#"  class="box-senadores ${$logo}" id="btn-directorio"  data-bs-toggle="modal" data-bs-target="#directorioIntegrantes" data-fraccion="${$logo}">\n      <span class='totales'>${o.total}</span>                      <img src='../images/iconos_partidos/GruposParlamentarios/${o.imgTotales}?version=${rand}' alt="${$logo}" class="img-responsive">\n                        </a>\n                    </div>`)
    }
    ))
}
function graficaIntegracion(a) {


    
    let o = []
      , e = []
      , i = [];
    $.each(a, (async function(a, t) {
        $nombre = "Movimiento Ciudadano" == t.abreviatura ? "MC" : t.abreviatura.toUpperCase() + "",
        o.push($nombre),
        e.push(t.total),
        i.push({
            name: $nombre,
            y: t.total,
            color: t.color
        })
    }
    ));

    
    var chart = am4core.create("chartdiv", am4charts.XYChart);

    chart.numberFormatter.numberFormat = "#.##";
    // Add data
    chart.data = i;
    
    // Create axes
    
    var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
    categoryAxis.dataFields.category = "name";
    categoryAxis.renderer.grid.template.location = 0;
    categoryAxis.renderer.minGridDistance = 20;

    var width =  $( window ).width();
    var rotate = 0;
    var pdy = -8;
    if(width <= 768){
    categoryAxis.renderer.labels.template.adapter.add("dy", function(dy, target) {
      if (target.dataItem && target.dataItem.index & 2 == 2) {
        return dy + 25;
      }
      return dy;
    });
    rotate = -90;
    pdy = -15;
    chart.numberFormatter.numberFormat = "#.#";
}
    
    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    valueAxis.min = 0;
    valueAxis.max = 50;
    // Create series
    var series = chart.series.push(new am4charts.ColumnSeries());
    series.calculatePercent = true;
    series.dataFields.valueY = "y";
    series.dataFields.categoryX = "name";
    series.dataFields.valueYShow = "percent";

    var bullet = series.bullets.push(new am4charts.LabelBullet);
    bullet.label.text = "[bold]{valueY.percent}%[/]";
    bullet.label.rotation = rotate;
    bullet.label.truncate = false;
    bullet.label.hideOversized = false;
    bullet.label.dy = pdy;

    series.columns.template.propertyFields.fill = "color";
    series.name = "y";
    series.columns.template.tooltipText = "{categoryX}: [bold]{valueY} Integrantes[/]";//"{categoryX}: [bold]{valueY} Integrantes[/] - [bold]{valueY.percent}%[/]";
    series.columns.template.fillOpacity = 1;
    series.strokeWidth = 0;
    var columnTemplate = series.columns.template;
    columnTemplate.strokeWidth = 1;
    columnTemplate.strokeOpacity = 1;



}
URL = "http://10.1.18.88/senado/64_3/",
$(document).ready((function(a) {
    var o;
    for ($("#pointGuia").draggable({
        stop: function(a) {
            $top = $("#pointGuia").css("top"),
            $left = $("#pointGuia").css("left"),
            copiarAlPortapapeles($top, $left)
        }
    }),
    i = 0; i < $(".pin").length; i++)
        $(".pin").eq(i).data("xpos"),
        $(".pin").eq(i).data("ypos");
    leerCoordMap().then((a=>{
        leerSenadores(a).then((a=>{
            $(".icon-asambleitas-partido").on("mouseenter", (function(a) {
                id = $(this).attr("id"),
                id = id.split("_"),
                $div = $(this).parent(),
                $offsetLeft = $div[0].offsetLeft,
                $offsetTop = $div[0].offsetTop,
                $div[0].offsetLeft > 300 && ($offsetLeft = $div[0].offsetLeft - 350,
                $offsetTop = $div[0].offsetTop - 50),
                $("#info_" + id[1]).css({
                    left: $offsetLeft + 50,
                    top: $offsetTop
                }).fadeIn(300),
                a.stopPropagation()
            }
            )).mouseleave((function() {
                id = $(this).attr("id"),
                id = id.split("_"),
                $("#info_" + id[1]).fadeOut(10)
            }
            )),
            $(".icon-asambleitas-partido").on("click", (function(a) {
                $senadorId = $(this)[0].attributes.id_senador.value,
                $senador = senadoresList.find((a=>a.idSenador == $senadorId)),
                $("#cont_mapa").hide(),
                $("#cont_detalle").show();
                let i = 120
                  , t = 60
                  , n = "11px"
                  , s = "width: 30px;height: 30px;";
                (e <= 380 || o.match(/Iphone/i) || o.match(/Ipod/i) || o.match(/Android/i) || o.match(/J2ME/i) || o.match(/BlackBerry/i) || o.match(/iPhone|iPad|iPod/i) || o.match(/Opera Mini/i) || o.match(/IEMobile/i) || o.match(/Mobile/i) || o.match(/Windows Phone/i) || o.match(/windows mobile/i) || o.match(/windows ce/i) || o.match(/webOS/i) || o.match(/palm/i) || o.match(/bada/i) || o.match(/series60/i) || o.match(/nokia/i) || o.match(/symbian/i) || o.match(/HTC/i)) && ($("#cont_detalle").css({
                    "font-size": "10px",
                    width: "100%"
                }),
                $(".infoEstado").css({
                    "font-size": "12px!important"
                }),
                i = 80,
                t = 40,
                s = "width: 20px;height: 20px;",
                n = "12px!important"),
                $("#infoFoto").html('<a href="../senador/' + $senador.idSenador + '"><img class="rounded "  src="../images/senadores/64/' + $senador.Foto + '" alt="" width="' + i + '"> </a>');
                let r = "";
                r = "Mujer" == $senador.Sexo ? "Senadora" : "Senador",
                $("#infoNombre").html('<a href="../senador/' + $senador.idSenador + '">' + r + " " + $senador.Nombre + " <br> " + $senador.Apellidos + " </a> "),
                $("#infoLogoEdo").attr({
                    src: "../images/escudos/" + $senador.Escudo,
                    width: t
                }),
                $("#infoEstado").html($senador.Estado),
                $logo = "Movimiento Ciudadano" == $senador.Fraccion ? "MC_.png" : $senador.Fraccion.toUpperCase() + "_.png",
                $("#infoLogoPartido").attr({
                    src: "../images/iconos_partidos/" + $logo,
                    width: t
                }),
                $senador.tipoEleccion.length > 90 ? $("#infoTipoEleccion").html($senador.tipoEleccion).css("font-size", "14px") : $("#infoTipoEleccion").html($senador.tipoEleccion).css("font-size", "16px"),
                $("#infoSuplente").html($senador.Suplente),
                $("#infoDireccion").html($senador.direccion),
                $("#infoCorreo").html($senador.correo),
                null !== $senador.telefono && $("#infoTel").html("01 (55) " + $senador.telefono + ", Ext. " + $senador.extension);
                let d = "";
                "" != $senador.url_sitio && null != $senador.url_sitio && (d += '<a href="' + $senador.url_sitio + '" target="_blank" class="" style="margin-left:4px;">',
                d += '<i class="fa-solid fa-globe  btn-reddit zoom" style="padding-top: 8px;text-align: center;' + s + '"></i>',
                d += "</a>"),
                "" != $senador.facebook && null != $senador.facebook && (d += '<a href="' + $senador.facebook + '" target="_blank" class="" style="margin-left:4px;">',
                d += '<i class="fa-brands fa-facebook btn-facebook zoom" style="padding-top: 8px;text-align: center;' + s + '"></i>',
                d += "</a> "),
                "" != $senador.twitter && null != $senador.twitter && (d += '<a href="' + $senador.twitter + '" target="_blank" class="" style="margin-left:1px;">',
                d += '<i class="fa-brands fa-x-twitter  btn-twitter zoom" style="padding-top: 8px;text-align: center;' + s + '"></i>',
                d += "</a>"),
                "" != $senador.instagram && null != $senador.instagram && (d += '<a href="' + $senador.instagram + '" target="_blank" class="" style="margin-left:4px;">',
                d += '<i class="fa-brands fa-instagram  btn-instagram zoom" style="padding-top: 8px;text-align: center;' + s + '"></i>',
                d += "</a>"),
                "" != $senador.youtube && null != $senador.youtube && (d += '<a href="' + $senador.youtube + '" target="_blank" class="" style="margin-left:4px;">',
                d += '<i class="fa-brands fa-youtube-play  btn-youtube zoom" style="padding-top: 8px;text-align: center;' + s + '"></i>',
                d += "</a>"),
                $("#infoRedesSoc").html(d)
            }
            ));
            let o = navigator.userAgent
              , e = $("#contMapa").width();
            e <= 380 || o.match(/Iphone/i) || o.match(/Ipod/i) || o.match(/Android/i) || o.match(/J2ME/i) || o.match(/BlackBerry/i) || o.match(/iPhone|iPad|iPod/i) || o.match(/Opera Mini/i) || o.match(/IEMobile/i) || o.match(/Mobile/i) || o.match(/Windows Phone/i) || o.match(/windows mobile/i) || o.match(/windows ce/i) || o.match(/webOS/i) || o.match(/palm/i) || o.match(/bada/i) || o.match(/series60/i) || o.match(/nokia/i) || o.match(/symbian/i) || o.match(/HTC/i) ? ($(".circulo").css({
                width: "12px",
                height: "12px"
            }),
            $(".txt_curul").css({
                "font-size": "8px",
                margin: "15px 0 0 -2px",
                "-webkit-transform": "rotate(-40deg)",
                "-moz-transform": "rotate(-40deg)"
            }),
            "landscape-primary" == (screen.orientation || screen.mozOrientation || screen.msOrientation).type ? $("#cont_mapa").css({
                width: "400px",
                margin: "0 auto"
            }) : $("#cont_mapa").css({
                width: "100%",
                margin: "0 auto"
            })) : $(".circulo").css({
                width: "22px",
                height: "22px"
            });
            graficaIntegracion($partidos_temporal),
            $(".imgGpo").click((function() {
                $fracc = $(this).attr("fraccion"),
                $senadorBuscar2 = [],
                $senadorBuscar2 = senadoresList.filter((a=>a.Fraccion == $fracc)),
                $senadorBuscar2 = $senadorBuscar2.sort(((a,o)=>a.Apellidos.localeCompare(o.Apellidos))),
                $(" .slideImgSenadores ").remove(),
                $(".containerSlide").append('<section class="center slider slideImgSenadores"></section>'),
                $.each($senadorBuscar2, (function(a, o) {
                    $nombre = o.Nombre + " " + o.Apellidos,
                    $img = `\n                    <div style="width: 78px;" class="contThumbnail">\n                        <a href="../senador/${o.idSenador}">\n                            <img src="../images/senadores/64/${o.Foto}"  idSenador="${o.idSenador}" class="img-thumbnail imgGpoSen hand" width="60" style="margin-left: 10px;height: 75px;">\n                        </a>\n                    </div>`,
                    $(".slideImgSenadores").append($img)
                }
                )),
                $(".slideImgSenadores").slick({
                    infinite: !1,
                    speed: 600,
                    slidesToShow: 5,
                    slidesToScroll: 5,
                    variableWidth: !0
                }),
                $(".imgGpoSen").on("mouseenter", (function(a) {
                    $idSenador = $(this).attr("idSenador"),
                    $offset = $(this).offset(),
                    $(".pin_" + $idSenador).css({
                        left: $offset.left - 280,
                        top: $offset.top - 500
                    }).fadeIn(300)
                }
                )).mouseleave((function() {
                    id = $(this).attr("idSenador"),
                    id = id.split("_"),
                    $(".pin_" + $idSenador).fadeOut(10)
                }
                ))
            }
            )),
            $(".imgGpo").eq(0).click()
        }
        ))
    }
    ))
}
));
